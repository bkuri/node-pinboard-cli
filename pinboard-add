#!/usr/bin/coffee
'use strict'


{argv, define, pinboard, respond, verbose, verify} = (require './tools')

verify()

command = (define 'Add a bookmark.')

command
  .option '-d, --date [date]', 'Date', (require 'moment')().format()
  .option '-e, --extended [ext]', 'Extended description'
  .option '-r, --replace', 'Replace existing entry'
  .option '-R, --to-read', 'Tag to read later'
  .option '-s, --shared', 'Shared'
  .option '-t, --tags <tags>', 'filter by up to 3 tags (comma-separated)'

  .action  (url, desc) ->
    reply = (what) -> if what? and (what is yes) then 'yes' else 'no'

    try
      bookmark =
        url: url
        description: desc
        extended: command.extended
        tags: command.tags
        dt: command.date
        replace: (reply command.replaced)
        shared: (reply command.shared)
        toread: (reply command.toRead)

      pinboard().add bookmark, (result) ->
        (respond result, 'result_code') if (command.verbose or process.env.PINBOARD_VERBOSE)

    catch e
      respond e, 'error'

  .usage '<url> <desc>'
  .parse argv()
